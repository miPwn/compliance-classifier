<header class="header">
  <div class="header-container">
    <!-- Logo -->
    <div class="logo-container">
      <a routerLink="/" class="logo">
        <img [src]="'assets/images/CUBE-Logo.png'" alt="CUBE Logo" class="logo-image" />
      </a>
    </div>
    
    <!-- Navigation -->
    <nav class="main-nav">
      <ul class="nav-list">
        <li class="nav-item">
          <a routerLink="/dashboard" routerLinkActive="active" class="nav-link">Dashboard</a>
        </li>
        <li class="nav-item">
          <a routerLink="/batches" routerLinkActive="active" class="nav-link">Batches</a>
        </li>
        <li class="nav-item">
          <a routerLink="/reports" routerLinkActive="active" class="nav-link">Reports</a>
        </li>
      </ul>
    </nav>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle-container">
      <button
        #themeToggleBtn
        class="header-button theme-toggle-button"
        onclick="
          const isDark = window.toggleTheme();
          this.querySelector('i').classList.toggle('pi-sun');
          this.querySelector('i').classList.toggle('pi-moon');
          this.querySelector('span').textContent = isDark ? 'Dark' : 'Light';
        "
        type="button">
        <i class="pi pi-sun"></i>
        <span>Light</span>
      </button>
    </div>
    
    <!-- AI Provider Dropdown -->
    <div class="ai-provider-container">
      <p-dropdown
        [options]="aiProviders"
        [(ngModel)]="selectedProvider"
        (onChange)="onProviderChange($event)"
        optionLabel="label"
        optionValue="value"
        styleClass="p-dropdown-sm">
        <ng-template pTemplate="selectedItem">
          <div class="flex align-items-center">
            <i class="pi pi-server mr-2"></i>
            <span>{{ selectedProvider | titlecase }}</span>
          </div>
        </ng-template>
      </p-dropdown>
    </div>
    
    <!-- Create Batch Button -->
    <div class="create-batch-container">
      <button
        class="header-button"
        (click)="createNewBatch()">
        <i class="pi pi-plus"></i>
        <span>Create New Batch</span>
      </button>
    </div>
    
    <!-- User Menu -->
    <div class="user-menu-container">
      <ng-container *ngIf="!isAuthenticated">
        <button
          class="header-button"
          (click)="login()">
          <i class="pi pi-sign-in"></i>
          <span>Login</span>
        </button>
      </ng-container>
      
      <ng-container *ngIf="isAuthenticated">
        <p-menu #menu [popup]="true" [model]="menuItems"></p-menu>
        
        <button
          class="header-button"
          (click)="menu.toggle($event)">
          <i class="pi pi-user"></i>
          <span class="username">{{ username }}</span>
        </button>
      </ng-container>
    </div>
  </div>
</header>

<!-- Initialize theme on page load -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Try to get theme from localStorage
    const savedTheme = localStorage.getItem('compliance-classifier-theme');
    const themeToggleBtn = document.querySelector('.theme-toggle-button');
    
    if (savedTheme === 'dark') {
      // Update button UI
      if (themeToggleBtn) {
        const icon = themeToggleBtn.querySelector('i');
        const text = themeToggleBtn.querySelector('span');
        
        if (icon) {
          icon.classList.remove('pi-sun');
          icon.classList.add('pi-moon');
        }
        
        if (text) {
          text.textContent = 'Dark';
        }
      }
    }
  });
</script>